<Window x:Class="GlDrive.UI.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="GlDrive Settings" Width="600" Height="500"
        WindowStartupLocation="CenterScreen" ResizeMode="NoResize"
        Background="{StaticResource BackgroundBrush}"
        Foreground="{StaticResource ForegroundBrush}">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0">
            <!-- Servers Tab -->
            <TabItem Header="Servers">
                <DockPanel Margin="12">
                    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Margin="0,10,0,0">
                        <Button Content="Add Server" Click="AddServer_Click"
                                Padding="12,6" Margin="0,0,6,0" Style="{StaticResource PrimaryButton}"/>
                        <Button Content="Edit" Click="EditServer_Click"
                                Padding="12,6" Margin="0,0,6,0" Style="{StaticResource SecondaryButton}"/>
                        <Button Content="Remove" Click="RemoveServer_Click"
                                Padding="12,6" Style="{StaticResource SecondaryButton}"/>
                    </StackPanel>
                    <DataGrid x:Name="ServerGrid"
                              AutoGenerateColumns="False" IsReadOnly="True"
                              SelectionMode="Single" GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="Enabled" Binding="{Binding Enabled}" Width="60"/>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Host" Binding="{Binding Host}" Width="150"/>
                            <DataGridTextColumn Header="Drive" Binding="{Binding DriveLetter}" Width="55"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <!-- Performance Tab -->
            <TabItem Header="Performance">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="12">
                        <!-- Downloads Section -->
                        <TextBlock Text="Downloads" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <TextBlock Text="Streaming Buffer Size (KB):" Margin="0,0,0,4"/>
                        <TextBox Text="{Binding StreamingBufferSize, UpdateSourceTrigger=PropertyChanged}"
                                 Width="80" HorizontalAlignment="Left" Margin="0,0,0,8"/>
                        <TextBlock Text="Write Buffer Limit (MB, 0=unlimited):" Margin="0,0,0,4"/>
                        <TextBox Text="{Binding WriteBufferLimit, UpdateSourceTrigger=PropertyChanged}"
                                 Width="80" HorizontalAlignment="Left" Margin="0,0,0,8"/>
                        <TextBlock Text="Max Concurrent Downloads:" Margin="0,0,0,4"/>
                        <TextBox Text="{Binding MaxConcurrentDownloads, UpdateSourceTrigger=PropertyChanged}"
                                 Width="80" HorizontalAlignment="Left" Margin="0,0,0,12"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Downloads Tab -->
            <TabItem Header="Downloads">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="12">
                        <TextBlock Text="Default Download Folder:" Margin="0,0,0,4"/>
                        <DockPanel Margin="0,0,0,8">
                            <Button DockPanel.Dock="Right" Content="Browse..." Click="BrowseDownloadPath_Click"
                                    Padding="8,4" Margin="8,0,0,0"/>
                            <TextBox Text="{Binding DownloadLocalPath, UpdateSourceTrigger=PropertyChanged}"/>
                        </DockPanel>

                        <TextBlock Text="Default Quality:" Margin="0,0,0,4"/>
                        <ComboBox ItemsSource="{Binding QualityOptions}"
                                  SelectedItem="{Binding QualityDefault}" Width="120"
                                  HorizontalAlignment="Left" Margin="0,0,0,8"/>

                        <TextBlock Text="OMDB API Key (for movie search):" Margin="0,0,0,4"/>
                        <TextBox Text="{Binding OmdbApiKey, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,8"/>

                        <CheckBox Content="Auto-download wishlist matches"
                                  IsChecked="{Binding AutoDownloadWishlist}" Margin="0,8,0,12"/>

                        <Separator Margin="0,0,0,12"/>

                        <!-- Category Path Routing -->
                        <TextBlock Text="Category Download Paths" FontWeight="SemiBold" Margin="0,0,0,4"/>
                        <TextBlock Text="Route specific categories to custom folders. Unmatched categories use the default path above."
                                   TextWrapping="Wrap" Foreground="#999" Margin="0,0,0,8" FontSize="11"/>
                        <DataGrid x:Name="CategoryPathGrid"
                                  AutoGenerateColumns="False" CanUserAddRows="False"
                                  SelectionMode="Single" GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column" Height="150" Margin="0,0,0,8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150"/>
                                <DataGridTextColumn Header="Download Path" Binding="{Binding Path}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        <StackPanel Orientation="Horizontal">
                            <Button Content="Add" Click="AddCategoryPath_Click" Padding="12,4" Margin="0,0,6,0"
                                    Style="{StaticResource SecondaryButton}"/>
                            <Button Content="Remove" Click="RemoveCategoryPath_Click" Padding="12,4"
                                    Style="{StaticResource SecondaryButton}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Diagnostics Tab -->
            <TabItem Header="Diagnostics">
                <StackPanel Margin="12">
                    <TextBlock Text="Log Level:" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding LogLevels}"
                              SelectedItem="{Binding LogLevel}" Width="150" HorizontalAlignment="Left" Margin="0,0,0,12"/>

                    <TextBlock Text="Trusted Certificates:" Margin="0,0,0,4" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding TrustedCertsInfo}" TextWrapping="Wrap" Margin="0,0,0,8"/>
                    <Button Content="Clear Trusted Certificates" Click="ClearCerts_Click"
                            HorizontalAlignment="Left" Padding="16,6" Margin="0,0,0,12"/>

                    <Button Content="Open Log Folder" Click="OpenLogs_Click"
                            HorizontalAlignment="Left" Padding="16,6"/>
                </StackPanel>
            </TabItem>
        </TabControl>

        <!-- Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="Save" Click="Save_Click" Padding="20,6" Margin="0,0,8,0"
                    Style="{StaticResource PrimaryButton}"/>
            <Button Content="Cancel" Click="Cancel_Click" Padding="20,6"
                    Style="{StaticResource SecondaryButton}"/>
        </StackPanel>
    </Grid>
</Window>
