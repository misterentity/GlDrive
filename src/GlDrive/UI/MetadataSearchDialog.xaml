<Window x:Class="GlDrive.UI.MetadataSearchDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="clr-namespace:GlDrive.UI"
        Title="Search" Width="720" Height="480"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize"
        MinWidth="600" MinHeight="380"
        Background="{StaticResource BackgroundBrush}"
        Foreground="{StaticResource ForegroundBrush}">
    <Window.Resources>
        <ui:ImageUrlConverter x:Key="ImageUrlConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>
    <Grid Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search bar -->
        <DockPanel Grid.Row="0" Margin="0,0,0,10">
            <Button DockPanel.Dock="Right" Content="Search" Click="Search_Click"
                    Padding="16,7" Margin="10,0,0,0" Style="{StaticResource PrimaryButton}"/>
            <TextBox x:Name="SearchBox" VerticalContentAlignment="Center"
                     KeyDown="SearchBox_KeyDown"/>
        </DockPanel>

        <!-- Results + Detail split -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="200"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="260"/>
            </Grid.ColumnDefinitions>

            <!-- Results list -->
            <ListBox Grid.Column="0" x:Name="ResultsList"
                     SelectionChanged="ResultsList_SelectionChanged"
                     Background="{StaticResource SurfaceBrush}"
                     BorderBrush="{StaticResource BorderBrush}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Margin="4,4">
                            <TextBlock Text="{Binding Title}" FontWeight="SemiBold" FontSize="13.5"
                                       Foreground="{StaticResource ForegroundBrush}"/>
                            <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                <TextBlock Text="{Binding YearDisplay}" Foreground="{StaticResource ForegroundDimBrush}" FontSize="11.5"/>
                                <TextBlock Text="{Binding RatingDisplay}" Foreground="{StaticResource AccentBrush}"
                                           FontSize="11.5" Margin="10,0,0,0" FontWeight="SemiBold"/>
                            </StackPanel>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <GridSplitter Grid.Column="1" Width="6" Background="Transparent"
                          HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

            <!-- Detail panel -->
            <Border Grid.Column="2" Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                    CornerRadius="6" Padding="14"
                    x:Name="DetailPanel" Visibility="Collapsed">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel>
                        <Border CornerRadius="4" ClipToBounds="True" Margin="0,0,0,10"
                                HorizontalAlignment="Center"
                                Background="{StaticResource SurfaceLightBrush}">
                            <Image x:Name="PosterImage" MaxWidth="150" Stretch="Uniform"
                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                        </Border>
                        <TextBlock x:Name="DetailTitle" FontWeight="Bold" FontSize="14.5"
                                   TextWrapping="Wrap" Margin="0,0,0,5"
                                   Foreground="White"/>
                        <TextBlock x:Name="DetailRating" FontSize="13"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource AccentBrush}" Margin="0,0,0,3"/>
                        <TextBlock x:Name="DetailGenres" FontSize="11.5"
                                   Foreground="{StaticResource ForegroundDimBrush}"
                                   TextWrapping="Wrap" Margin="0,0,0,10"/>
                        <TextBlock x:Name="DetailPlot" FontSize="12" TextWrapping="Wrap"
                                   LineHeight="18"
                                   Foreground="{StaticResource ForegroundDimBrush}"
                                   MaxHeight="160"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Quality -->
        <DockPanel Grid.Row="2" Margin="0,10,0,10">
            <TextBlock Text="Quality:" VerticalAlignment="Center" Margin="0,0,8,0"
                       Foreground="{StaticResource ForegroundBrush}"/>
            <ComboBox x:Name="QualityCombo" Width="120" HorizontalAlignment="Left">
                <ComboBoxItem Content="Any" IsSelected="True"/>
                <ComboBoxItem Content="SD"/>
                <ComboBoxItem Content="720p"/>
                <ComboBoxItem Content="1080p"/>
                <ComboBoxItem Content="2160p"/>
            </ComboBox>
        </DockPanel>

        <!-- Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Add" Click="Ok_Click" Padding="24,8" Margin="0,0,8,0"
                    Style="{StaticResource PrimaryButton}" x:Name="OkButton" IsEnabled="False"/>
            <Button Content="Cancel" Click="Cancel_Click" Padding="24,8"
                    Style="{StaticResource SecondaryButton}"/>
        </StackPanel>
    </Grid>
</Window>
