<Window x:Class="GlDrive.UI.DashboardWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="clr-namespace:GlDrive.UI"
        Title="GlDrive Dashboard" Width="960" Height="660"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        Foreground="{StaticResource ForegroundBrush}">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <ui:ImageUrlConverter x:Key="ImageUrlConverter"/>
    </Window.Resources>
    <Grid Margin="0">
        <TabControl Padding="0">
            <!-- Wishlist Tab -->
            <TabItem Header="Wishlist">
                <DockPanel Margin="12">
                    <!-- Action bar -->
                    <Border DockPanel.Dock="Top" Background="{StaticResource SurfaceBrush}"
                            CornerRadius="6" Padding="8,6" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <Button Content="+ Movie" Command="{Binding AddMovieCommand}"
                                    Padding="12,6" Margin="0,0,6,0" Style="{StaticResource PrimaryButton}"/>
                            <Button Content="+ TV Show" Command="{Binding AddTvShowCommand}"
                                    Padding="12,6" Margin="0,0,12,0" Style="{StaticResource PrimaryButton}"/>
                            <Button Content="Remove" Command="{Binding RemoveWishlistCommand}"
                                    Padding="12,6" Margin="0,0,6,0" Style="{StaticResource SecondaryButton}"/>
                            <Button Content="Pause" Command="{Binding TogglePauseCommand}"
                                    Padding="12,6" Margin="0,0,6,0" Style="{StaticResource SecondaryButton}"/>
                            <Button Content="Refresh Info" Command="{Binding RefreshMetadataCommand}"
                                    Padding="12,6" Style="{StaticResource SecondaryButton}"
                                    ToolTip="Fetch posters, ratings, and plots for all items"/>
                        </StackPanel>
                    </Border>

                    <!-- Detail panel — bottom -->
                    <Border DockPanel.Dock="Bottom" Height="155"
                            Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                            CornerRadius="6" Margin="0,10,0,0" Padding="14"
                            Visibility="{Binding HasWishlistSelection, Converter={StaticResource BoolToVisibility}}">
                        <DockPanel>
                            <Border DockPanel.Dock="Left" Width="95" Margin="0,0,16,0"
                                    CornerRadius="4" ClipToBounds="True"
                                    Background="{StaticResource SurfaceLightBrush}"
                                    Visibility="{Binding HasSelectedPoster, Converter={StaticResource BoolToVisibility}}">
                                <Image Stretch="UniformToFill" VerticalAlignment="Top"
                                       RenderOptions.BitmapScalingMode="HighQuality"
                                       Source="{Binding SelectedPosterUrl, Converter={StaticResource ImageUrlConverter}, ConverterParameter=120}"/>
                            </Border>
                            <StackPanel VerticalAlignment="Top">
                                <TextBlock FontWeight="Bold" FontSize="16"
                                           Foreground="White">
                                    <Run Text="{Binding SelectedWishlistItem.Title, Mode=OneWay}"/>
                                    <Run Text=" ("/>
                                    <Run Text="{Binding SelectedWishlistItem.Year, Mode=OneWay}"/>
                                    <Run Text=")"/>
                                </TextBlock>
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="{Binding SelectedRating}" FontSize="13"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource AccentBrush}"/>
                                    <TextBlock Text="{Binding SelectedGenres}" FontSize="12.5"
                                               Foreground="{StaticResource ForegroundDimBrush}"
                                               Margin="14,0,0,0"/>
                                </StackPanel>
                                <TextBlock Text="{Binding SelectedPlot}" TextWrapping="Wrap"
                                           MaxHeight="65" FontSize="12.5" Margin="0,8,0,0"
                                           LineHeight="18"
                                           Foreground="{StaticResource ForegroundDimBrush}"
                                           TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </DockPanel>
                    </Border>

                    <!-- DataGrid -->
                    <DataGrid ItemsSource="{Binding WishlistItems}"
                              SelectedItem="{Binding SelectedWishlistItem}"
                              AutoGenerateColumns="False" IsReadOnly="True"
                              SelectionMode="Single" GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="70"/>
                            <DataGridTextColumn Header="Year" Binding="{Binding Year}" Width="60"/>
                            <DataGridTextColumn Header="Quality" Binding="{Binding Quality}" Width="80"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80"/>
                            <DataGridTextColumn Header="Grabbed" Binding="{Binding GrabbedCount}" Width="65"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <!-- Downloads Tab -->
            <TabItem Header="Downloads">
                <DockPanel Margin="12">
                    <!-- Active download progress -->
                    <StackPanel DockPanel.Dock="Top" Margin="0,0,0,10"
                                Visibility="{Binding HasActiveDownload, Converter={StaticResource BoolToVisibility}}">
                        <TextBlock Foreground="{StaticResource ForegroundBrush}" Margin="0,0,0,6">
                            <Run Text="{Binding ActiveDownloadName, Mode=OneWay}" FontWeight="SemiBold"/>
                            <Run Text=" — " Foreground="{StaticResource ForegroundDimBrush}"/>
                            <Run Text="{Binding ActiveDownloadSpeed, Mode=OneWay}" Foreground="{StaticResource AccentBrush}"/>
                        </TextBlock>
                        <ProgressBar Value="{Binding ActiveDownloadPercent}" Maximum="100" Height="6" Margin="0,0,0,0"/>
                    </StackPanel>

                    <Border DockPanel.Dock="Top" Background="{StaticResource SurfaceBrush}"
                            CornerRadius="6" Padding="8,6" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <Button Content="Cancel" Command="{Binding CancelDownloadCommand}"
                                    Padding="12,6" Margin="0,0,6,0" Style="{StaticResource SecondaryButton}"/>
                            <Button Content="Retry" Command="{Binding RetryDownloadCommand}"
                                    Padding="12,6" Margin="0,0,6,0" Style="{StaticResource SecondaryButton}"/>
                            <Button Content="Clear Completed" Command="{Binding ClearCompletedCommand}"
                                    Padding="12,6" Style="{StaticResource SecondaryButton}"/>
                        </StackPanel>
                    </Border>
                    <DataGrid ItemsSource="{Binding DownloadItems}"
                              SelectedItem="{Binding SelectedDownloadItem}"
                              AutoGenerateColumns="False" IsReadOnly="True"
                              SelectionMode="Single" GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Release" Binding="{Binding ReleaseName}" Width="*"/>
                            <DataGridTextColumn Header="Server" Binding="{Binding ServerName}" Width="90"/>
                            <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="80"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="90"/>
                            <DataGridTextColumn Header="Progress" Binding="{Binding ProgressText}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <!-- Search Tab -->
            <TabItem Header="Search">
                <DockPanel Margin="12">
                    <DockPanel DockPanel.Dock="Top" Margin="0,0,0,10">
                        <Button DockPanel.Dock="Right" Content="Search" Command="{Binding SearchCommand}"
                                Padding="18,6" Margin="10,0,0,0" Style="{StaticResource PrimaryButton}"/>
                        <TextBox Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                                 VerticalContentAlignment="Center">
                            <TextBox.InputBindings>
                                <KeyBinding Key="Return" Command="{Binding SearchCommand}"/>
                            </TextBox.InputBindings>
                        </TextBox>
                    </DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="{Binding SearchStatus}" Margin="0,0,0,6"
                               Foreground="{StaticResource ForegroundDimBrush}" FontSize="12"/>
                    <DockPanel DockPanel.Dock="Bottom" Margin="0,10,0,0">
                        <Button Content="Download Selected" Command="{Binding DownloadSearchResultCommand}"
                                Padding="16,6" Style="{StaticResource PrimaryButton}"/>
                    </DockPanel>
                    <DataGrid ItemsSource="{Binding SearchResults}"
                              SelectedItem="{Binding SelectedSearchResult}"
                              AutoGenerateColumns="False" IsReadOnly="True"
                              SelectionMode="Single" GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Release" Binding="{Binding ReleaseName}" Width="*"/>
                            <DataGridTextColumn Header="Server" Binding="{Binding ServerName}" Width="90"/>
                            <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="100"/>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeText}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>
            <!-- Upcoming Tab -->
            <TabItem Header="Upcoming">
                <DockPanel Margin="12">
                    <!-- Action bar -->
                    <Border DockPanel.Dock="Top" Background="{StaticResource SurfaceBrush}"
                            CornerRadius="6" Padding="8,6" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <Button Content="Refresh" Command="{Binding LoadUpcomingCommand}"
                                    Padding="12,6" Margin="0,0,6,0" Style="{StaticResource PrimaryButton}"/>
                            <Button Content="Add to Wishlist" Command="{Binding AddUpcomingToWishlistCommand}"
                                    Padding="12,6" Margin="0,0,12,0" Style="{StaticResource PrimaryButton}"/>
                            <TextBlock Text="Quality:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <ComboBox ItemsSource="{Binding QualityOptions}"
                                      SelectedItem="{Binding UpcomingQualityText}" Width="90"/>
                            <TextBlock Text="{Binding UpcomingStatus}" VerticalAlignment="Center"
                                       Margin="16,0,0,0" Foreground="{StaticResource ForegroundDimBrush}" FontSize="12"/>
                        </StackPanel>
                    </Border>

                    <!-- Detail panel — bottom -->
                    <Border DockPanel.Dock="Bottom" Height="155"
                            Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                            CornerRadius="6" Margin="0,10,0,0" Padding="14"
                            Visibility="{Binding HasUpcomingSelection, Converter={StaticResource BoolToVisibility}}">
                        <DockPanel>
                            <Border DockPanel.Dock="Left" Width="95" Margin="0,0,16,0"
                                    CornerRadius="4" ClipToBounds="True"
                                    Background="{StaticResource SurfaceLightBrush}"
                                    Visibility="{Binding HasUpcomingPoster, Converter={StaticResource BoolToVisibility}}">
                                <Image Stretch="UniformToFill" VerticalAlignment="Top"
                                       RenderOptions.BitmapScalingMode="HighQuality"
                                       Source="{Binding UpcomingPosterUrl, Converter={StaticResource ImageUrlConverter}, ConverterParameter=120}"/>
                            </Border>
                            <StackPanel VerticalAlignment="Top">
                                <TextBlock Text="{Binding UpcomingDetailTitle}" FontWeight="Bold" FontSize="16"
                                           Foreground="White"/>
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="{Binding UpcomingRating}" FontSize="13"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource AccentBrush}"/>
                                    <TextBlock Text="{Binding UpcomingGenres}" FontSize="12.5"
                                               Foreground="{StaticResource ForegroundDimBrush}"
                                               Margin="14,0,0,0"/>
                                </StackPanel>
                                <TextBlock Text="{Binding UpcomingPlot}" TextWrapping="Wrap"
                                           MaxHeight="65" FontSize="12.5" Margin="0,8,0,0"
                                           LineHeight="18"
                                           Foreground="{StaticResource ForegroundDimBrush}"
                                           TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </DockPanel>
                    </Border>

                    <!-- Two side-by-side grids -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- TV Schedule -->
                        <DockPanel Grid.Column="0">
                            <TextBlock DockPanel.Dock="Top" Text="TV Schedule (Next 7 Days)"
                                       FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <DataGrid ItemsSource="{Binding UpcomingTvEpisodes}"
                                      SelectedItem="{Binding SelectedTvEpisode}"
                                      AutoGenerateColumns="False" IsReadOnly="True"
                                      SelectionMode="Single" GridLinesVisibility="Horizontal"
                                      HeadersVisibility="Column" CanUserAddRows="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Date" Binding="{Binding DateDisplay}" Width="75"/>
                                    <DataGridTextColumn Header="Show" Binding="{Binding ShowName}" Width="*"/>
                                    <DataGridTextColumn Header="Episode" Binding="{Binding EpisodeInfo}" Width="140"/>
                                    <DataGridTextColumn Header="Time" Binding="{Binding TimeDisplay}" Width="55"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </DockPanel>

                        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch"
                                      Background="Transparent"/>

                        <!-- Movie Releases -->
                        <DockPanel Grid.Column="2">
                            <TextBlock DockPanel.Dock="Top" FontWeight="SemiBold" Margin="0,0,0,6">
                                <Run Text="Movie Releases"/>
                            </TextBlock>
                            <TextBlock DockPanel.Dock="Top" Margin="0,0,0,6" FontSize="11"
                                       Foreground="{StaticResource ForegroundDimBrush}"
                                       Visibility="{Binding HasNoTmdbKey, Converter={StaticResource BoolToVisibility}}">
                                <Run Text="Configure TMDb API key in Settings → Downloads to see movie releases."/>
                            </TextBlock>
                            <DataGrid ItemsSource="{Binding UpcomingMovies}"
                                      SelectedItem="{Binding SelectedUpcomingMovie}"
                                      AutoGenerateColumns="False" IsReadOnly="True"
                                      SelectionMode="Single" GridLinesVisibility="Horizontal"
                                      HeadersVisibility="Column" CanUserAddRows="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*"/>
                                    <DataGridTextColumn Header="Year" Binding="{Binding Year}" Width="50"/>
                                    <DataGridTextColumn Header="Date" Binding="{Binding ReleaseDateDisplay}" Width="85"/>
                                    <DataGridTextColumn Header="Genres" Binding="{Binding Genres}" Width="110"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </DockPanel>
                    </Grid>
                </DockPanel>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
